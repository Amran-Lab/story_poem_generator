# Documentation
---
# Poem & Story Generator

This is for the second project set by QA

## Table of Contents

1. [Project Brief](#project-brief)
    + [Proposal](#proposal)
    + [Wireframes](#wireframes)
2. [Trello Board](#trello-board)
    + [Start Point](#start-board)
    + [Rolling Changes](#rolling-changes)
    + [End Point](#end-point)
3. [Risk Assessment](#risk-assessment)
4. [Project Architecture](#project-architecture)
    + [Architecture Diagram](#architecture-diagram)
    + [Issues Encountered](#issues-encountered)
5. [Design Considerations](#design-considerations)
    + [Front End](#front-end)
    + [Back End](#back-end)
    + [UI](#ui)
6. [Testing](#testing)
    + [Pytest Testing](#pytest)
    + [Final Report](#final-report)
7. [Deployment](#deployment)
    + [Toolset](#toolset)
8. [Retrospective](#retrospective)
9. [Author](#authors)

## Project Brief

To create an app using:
+ Software Development with Python
+ CI/CD using Jenkins, Ansible pipeline (Seperate Cloud Services)
+ Nginx as reverse proxy
+ Managed MySQL database on the cloud
+ Docker and Orchestration using Docker-Swarm, Split app into micro-services in the cloud with built in redundancies such as Load-Balancing behind Nginx. (One Manager node, One Worker Node in Swarm)
+ Use Ansible to set up all VM's (Installing Dependencies and applications) using Playbook
+ Use Jenkins to set up multiple stages in the pipeline; Staging, Testing, Building and Deployment and implement a Git Webhook as a trigger
+ Implement Cloud Fundamentals such as test driven development, Continuous Integration and deployment, and a SCRUM based methodology
+ Micro-service oriented architecture composed of at least 4 services that work together and services 2,3,4 should be easily interchangeable using versioning on Dockerhub.

### Proposal

I decided to create a Story & Poem Generator with a Microservice architecture. My application will have 4 services not including Jenkins, Managed MYSQL db, Nginx server, Ansible Server and Docker Swarm.

+ Service 1 of my project is essentially the front-end where the stories and poems are displayed.
+ Service 2 and 3 will be services that generate the random theme and character name.
+ Service 4 is the back-end that decides between whether the user gets a "story" or a "poem".
+ I will be using Ansible as a way to stage all my environments, prepare them to run my services and deploy the docker swarm.
+ I will use Jenkins to build a testing and deployment pipeline using Jenkinsfile that will be triggered using Git/Github webhook
+ Nginx will be used as a Reverse Proxy to load balance all my services running on Docker Swarm

### Wireframes

<img src="https://i.imgur.com/pWyR2jp.png" title="wireframes" />

+ My initial idea was to have a simple button so when the user pressed it, it displayed a story of a random theme with random character names substituted in it. In other words, service two picks out a theme at a random from a list of three and service three picks out a male and female character name from a list of fourteen, for which service four puts it all together and sends it back to service one. 

+ To make it more user friendly/interactive, I changed it so that the user gets to choose the theme and character name they want by adding user input. This shortened the character name list to three from fourteen. 

+ In the end, instead of having service four take a lot in with sending a whole story over to service one, I thought I could just store the literacy pieces in service one and have service four just choose between poem and story depending on service two and three. 


## Asana Board

I used a kanban board on Asana to manage my workflow during the project. Agile methodology was implemented in line with the brief, in terms of product and sprint backlog, although due to the individual nature of the project, no scrum working practices were applied. The board was set up with reference to potential user stories. I split the sprints into smaller tasks in order to keep the requirements of the project spec clear.

Due to this setup sprints could be passed through development, and, if required, testing, before being assigned to Done. Once sprints generated by a backlogged Task have been completed, the task itself can be marked Done. Functionalities that requirement more time and weren't neccessary to implement are given over to the newly added Dropped ideas column.

### Start Point

<img width="250" src="https://i.imgur.com/KQNZeaX.jpg" title="moscow key" /> 

<img width="200" src="https://i.imgur.com/VTKAvln.jpg" title="product backlog1" /> <img width="200" src="https://i.imgur.com/6khWR1B.jpg" title="product backlog2" /> <img width="200" src="https://i.imgur.com/SmZF0a4.jpg" title="product backlog3" /> <img width="200" src="https://i.imgur.com/jxzMAkA.jpg" title="product backlog4" />


<img src="https://i.imgur.com/JZuSiNO.png" title="sprint1" />

At the start of the project, I focused on the five tasks most easily completable in the first week of training: Starting the Kanban board [itself](https://app.asana.com/0/1169906447683321/board), starting this documentation, instituting a github repository for the project, which can be found [here](https://github.com/thenu97/story_poem_generator), initialising the risk assessment for the project in line with my initial understanding, and researching Docker covered in lesson as we went along.

### Rolling Changes

+ The first major change to the Kanban board to changing my idea from a user pressing a button to selecting data; theme and character names. This meant I had to change my html code and find a way to communicate the user input to service two and three. Then communicate this info to service four at the same time. I spent most of my time researching flask before_requests and after_requests, and using global variables to store data coming in at different times. 

+ As I was using global variables to solve my issue of post requests coming in at different times, I was faced with another issue when replicating the container for docker swarm. The global variables were container specific so when I was replicating it, the global variables reset to empty. To solve this, I had three options: to replicate the services utilising global variables once and document the issue, research into docker volumes and see if there's a way of replicating the containers based on the volumes of the original container, or re-design my entire application to ensure it wasn't using global variables at all. In the end, I went with the third option and gave myself a day to re-design the application and if it wasn't completed within that time-frame to result in the first resolution. 

+ Reaching the end of week two, I had an application that didn't use global variables and had also found a way to programme Ansible to set the environment (downloading docker) assign worker/manager nodes without having to ssh into each virtual machine and manually doing it ourselves. I also researched into what I had to do for testing so added that onto to Yet to start on the kanban board. 

+ SonarQube was not a requirement to implement so that became a dropped idea. 

### End Point

<img src="https://i.imgur.com/Zqspd1D.png" title="ending" />


## Risk Assessment

|Risk No.|Risk|Effect|Likelihood|Serverity|Importance|Mitigate|
|---|---|---|---|---|---|---|
|1|Problems with developing 4 services.|Failed project as this is a needed requirement|3|5|15|Do more research into mircoservices and how systems involved work together.|
|2|Overrunning on GCP free data limits.|An instance is left running, or an account breach enables the resources on the account to be drained.|1|5|5|Continue monitoring GCP usage. Copy databases offline as final backup.|
|3|Problems with Python/Flask|Failed project as this is needed for the front end and backend of my application.|1|2|2|Practise Python through continuous challenges on Codewars.|
|4|Problems with Jenkins|Not being able to CI/CD|2|3|6|Do more research into using Jenkins with Docker Swarm.|
|5|Using Ansible Playbook|The project requires this but due to not using ansible before, this holds a great risk.|3|4|12|Study how Ansible is used through documentation provided and asked my trainer for resources.|
|6|Docker|Required by the project but I haven't used this tool before so it holds high risks.|2|3|6|Research and docker documentation.|


<img src="https://i.imgur.com/I0HiOw2.png" title="risk matrix" />


|Risk No.|Risk|Solution|
|---|---|---|---|
|1|The brief being too hard to decipherAsked my peers, and emailed my manager to join our daily standups who explained the brief in more detail.|
|2|Developing mircoservices as it was a new concept to me|I put in hours of research to figure out how everything interlinked.|
|3|GCP free credit running out|I stopped an instance when it wasn't being used and monitored the rate of credit drop.|
|4|Facing issues with python/flask|Ensured I was doing at least 3 challenges a day to keep my python knowledge on pur.|
|5|Jenkins automated build|I researched into how Docker Swarm tied in with Jenkins and drew a pipeline that help me grasp the idea better.|
|6|Ansible - worker nodes|Researched into it and I was eventually able to support my colleagues with a solution that managed docker clusters.|
|7|Docker Swarm|Docker wasn't as hard as I expected to understand. Continuous practise helped a lot.|
|8|GCP service was throwing errors when running website|Recorded the deployment process so I can demonstrate it during presentation.|


## Project Architecture

### Overall Architecture

<img src="https://i.imgur.com/i3cK01G.jpg" title="deployment process" />

At stage one, once the code is changed on visual studios, you push it up to GitHub. This initiates an automated Jenkins build at stage two. Jenkins then ensures ansible is started up at stage three. Ansible then pushes the new built image to Docker registry (Docker Hub). Ansible also assigns worker/manager nodes at stage four. At stage five, the manager node pulls down the image from Docker Hub and creates multiple containers (defined in docker-compose file) then deploys it to the worker nodes that are assigned to it. In my case, only one worker node was created. 

<img src="https://i.imgur.com/YoNkeW8.png" title="communication" />

The user presses a button that generates a random story. As the user only interacts and sees service one, HTML post and get requests were used to share information between the services. When we containerised our applications, we linked the containers by creating a docker network and allowing the connection to flow the same way as before. 

### Deployment

### Toolset

<img src="https://i.imgur.com/wl13iqk.png" title="toolset" />

+ GCP Instance development environment

+ GitHub Webhook

+ Jenkins Server

+ Pipeline build coded in Groovy and Shell.

+ Testing in Pytest using the Coverage module.

+ Ansible

+ Docker/Docker Swarm

### Issues Encountered

+ 

+ 


## Testing

### Pytest

<img src="https://i.imgur.com/hll5I14.jpg" title="coverage html" />

The coverage is at 56% because ....


## Retrospective

### What Went Well?
+ The application was up and running within the containers linked by an overlay network. Dockerising the flask app was definitely the easiest and went well without any issues. 

### What Didn't Go Well?
+ Ansible was a little harder to grasp as it was completely new and the documentation for it was much more dense than docker. 

### Future Improvements
+ 



## Authors

Thenuja Viknarajah
